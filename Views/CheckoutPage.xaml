<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:MauiFrontend.ViewModels"
             xmlns:model="clr-namespace:MauiFrontend.Models"
             x:Class="MauiFrontend.Views.CheckoutPage"
             x:DataType="vm:CheckoutPageViewModel"
             Title="Thanh Toán"
             BackgroundColor="#FFFFFF">

    <Grid RowDefinitions="*, Auto" Padding="0">

        <!-- Nội dung chính -->
        <ScrollView Grid.Row="0">
            <VerticalStackLayout Padding="16" Spacing="20">

                <!-- Tiêu đề -->
                <Label Text="Thông Tin Giao Hàng" 
                       FontSize="18" 
                       FontAttributes="Bold"
                       TextColor="#333333"/>

                <!-- Form nhập liệu -->
                <VerticalStackLayout Spacing="12">

                    <!-- Họ tên -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Họ tên *" FontSize="14" FontAttributes="Bold" TextColor="#333333"/>
                        <Frame BorderColor="#DDDDDD" CornerRadius="6" HasShadow="False" Padding="0">
                            <Entry Placeholder="Nhập họ tên đầy đủ"
                                   Text="{Binding Fullname}"
                                   PlaceholderColor="#999999"
                                   TextColor="#333333"
                                   FontSize="14"
                                   Margin="12,8"/>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- Email -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Email *" FontSize="14" FontAttributes="Bold" TextColor="#333333"/>
                        <Frame BorderColor="#DDDDDD" CornerRadius="6" HasShadow="False" Padding="0">
                            <Entry Placeholder="example@mail.com"
                                   Text="{Binding Email}"
                                   Keyboard="Email"
                                   PlaceholderColor="#999999"
                                   TextColor="#333333"
                                   FontSize="14"
                                   Margin="12,8"/>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- Số điện thoại -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Số Điện Thoại *" FontSize="14" FontAttributes="Bold" TextColor="#333333"/>
                        <Frame BorderColor="#DDDDDD" CornerRadius="6" HasShadow="False" Padding="0">
                            <Entry Placeholder="0912345678"
                                   Text="{Binding PhoneNumber}"
                                   Keyboard="Telephone"
                                   PlaceholderColor="#999999"
                                   TextColor="#333333"
                                   FontSize="14"
                                   Margin="12,8"
                                   MaxLength="11"/>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- Địa chỉ -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Địa Chỉ *" FontSize="14" FontAttributes="Bold" TextColor="#333333"/>
                        <Frame BorderColor="#DDDDDD" CornerRadius="6" HasShadow="False" Padding="0">
                            <Editor Placeholder="Nhập địa chỉ giao hàng"
                                    Text="{Binding Address}"
                                    PlaceholderColor="#999999"
                                    TextColor="#333333"
                                    FontSize="14"
                                    Margin="12,8"
                                    HeightRequest="80"/>
                        </Frame>
                    </VerticalStackLayout>

                    <!-- Ghi chú -->
                    <VerticalStackLayout Spacing="6">
                        <Label Text="Ghi Chú (Tùy Chọn)" FontSize="14" FontAttributes="Bold" TextColor="#333333"/>
                        <Frame BorderColor="#DDDDDD" CornerRadius="6" HasShadow="False" Padding="0">
                            <Editor Placeholder="Ghi chú cho đơn hàng"
                                    Text="{Binding Note}"
                                    PlaceholderColor="#999999"
                                    TextColor="#333333"
                                    FontSize="14"
                                    Margin="12,8"
                                    HeightRequest="60"/>
                        </Frame>
                    </VerticalStackLayout>

                </VerticalStackLayout>

                <!-- Phí vận chuyển cố định -->
                <Frame BorderColor="#DDDDDD" CornerRadius="8" HasShadow="False" Padding="12" BackgroundColor="#F5F5F5">
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                        <Label Grid.Column="0" 
                               Text="Phí Vận Chuyển" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="#333333"
                               VerticalOptions="Center"/>
                        <Label Grid.Column="1" 
                               Text="30,000 ₫" 
                               FontSize="14" 
                               FontAttributes="Bold"
                               TextColor="#F9A825"
                               VerticalOptions="Center"/>
                    </Grid>
                </Frame>

                <!-- Danh sách sản phẩm -->
                <VerticalStackLayout Spacing="8">
                    <Label Text="Sản Phẩm Trong Đơn" FontSize="16" FontAttributes="Bold" TextColor="#333333"/>

                    <CollectionView ItemsSource="{Binding CartItems}" SelectionMode="None">
                        <CollectionView.ItemTemplate>
                            <DataTemplate x:DataType="model:CartItem">
                                <Frame BorderColor="#EEEEEE" 
                                       CornerRadius="8" 
                                       HasShadow="False" 
                                       Padding="12" 
                                       Margin="0,4"
                                       BackgroundColor="#FFFFFF">
                                    <Grid ColumnDefinitions="70,*,100" ColumnSpacing="12">
                                        <!-- Thumbnail -->
                                        <Frame Grid.Column="0"
                                               BorderColor="#DDDDDD"
                                               CornerRadius="6"
                                               HasShadow="False"
                                               Padding="0"
                                               HeightRequest="70"
                                               WidthRequest="70">
                                            <Image Source="{Binding Thumbnail}"
                                                   Aspect="AspectFill"/>
                                        </Frame>

                                        <!-- Thông tin sản phẩm -->
                                        <VerticalStackLayout Grid.Column="1" Spacing="4" VerticalOptions="Center">
                                            <Label Text="{Binding Name}" 
                                                   FontSize="13" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#333333"
                                                   LineBreakMode="TailTruncation"/>
                                            <Label Text="{Binding FormattedFinalPrice}" 
                                                   FontSize="12" 
                                                   TextColor="#F9A825"/>
                                            <Label Text="{Binding DiscountText}" 
                                                   FontSize="11" 
                                                   TextColor="#FF6B6B"
                                                   IsVisible="{Binding HasDiscount}"/>
                                        </VerticalStackLayout>

                                        <!-- Số lượng -->
                                        <VerticalStackLayout Grid.Column="2" Spacing="4" VerticalOptions="Center" HorizontalOptions="End">
                                            <Label Text="{Binding Quantity, StringFormat='SL: {0}'}" 
                                                   FontSize="12" 
                                                   TextColor="#666666"/>
                                            <Label Text="{Binding FormattedTotalPrice}" 
                                                   FontSize="13" 
                                                   FontAttributes="Bold" 
                                                   TextColor="#333333"/>
                                        </VerticalStackLayout>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>

            </VerticalStackLayout>
        </ScrollView>

        <!-- Footer với nút thanh toán -->
        <Frame Grid.Row="1" BorderColor="#EEEEEE" HasShadow="False" CornerRadius="0" Padding="16" BackgroundColor="#FFFFFF">
            <VerticalStackLayout Spacing="12">

                <!-- Tóm tắt tiền -->
                <Frame BorderColor="#EEEEEE" CornerRadius="8" HasShadow="False" Padding="12" BackgroundColor="#F5F5F5">
                    <VerticalStackLayout Spacing="8">
                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <Label Grid.Column="0" Text="Tổng tiền sản phẩm" FontSize="12" TextColor="#666666"/>
                            <Label Grid.Column="1" Text="{Binding FormattedTotalAmount}" FontSize="12" TextColor="#666666"/>
                        </Grid>

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <Label Grid.Column="0" Text="Phí vận chuyển" FontSize="12" TextColor="#666666"/>
                            <Label Grid.Column="1" Text="30,000 ₫" FontSize="12" TextColor="#666666"/>
                        </Grid>

                        <BoxView HeightRequest="1" Color="#DDDDDD" Margin="0,4"/>

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                            <Label Grid.Column="0" Text="Tổng cộng" FontSize="14" FontAttributes="Bold" TextColor="#333333"/>
                            <Label Grid.Column="1" 
                                   Text="{Binding FormattedFinalTotal}"
                                   FontSize="14" 
                                   FontAttributes="Bold" 
                                   TextColor="#F9A825"/>
                        </Grid>
                    </VerticalStackLayout>
                </Frame>

                <!-- Nút thanh toán -->
                <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                    <Button Grid.Column="0"
                            Text="Quay Lại"
                            Command="{Binding GoBackCommand}"
                            BackgroundColor="#E0E0E0"
                            TextColor="#333333"
                            FontAttributes="Bold"
                            CornerRadius="8"
                            Padding="12,8"
                            FontSize="14"/>

                    <Button Grid.Column="1"
                            Text="Xác Nhận Thanh Toán"
                            Command="{Binding SubmitCheckoutCommand}"
                            BackgroundColor="#F9A825"
                            TextColor="#FFFFFF"
                            FontAttributes="Bold"
                            CornerRadius="8"
                            Padding="12,8"
                            FontSize="14"
                            IsEnabled="{Binding IsFormValid}"/>
                </Grid>

                <!-- Loading indicator -->
                <ActivityIndicator IsRunning="{Binding IsProcessing}"
                                 IsVisible="{Binding IsProcessing}"
                                 Color="#F9A825"
                                 Scale="1.2"/>

            </VerticalStackLayout>
        </Frame>

    </Grid>

</ContentPage>